<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registros - HydroScan</title>
    <link rel="stylesheet" href="../public/css/pages.css">
    <!-- Boxicons CSS -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="../public/img/Logo-pequena.png" type="image/x-icon">
</head>
<body>
    <header class="navbar">
        <nav class="nav-esquerda">
            <a href="../index.html">
                <img class="img-logo" src="../public/img/Logo-pequena.png" alt="Logo da empresa">
            </a>
            <a href="../pages/calculadora.html">Calculadora</a>
            <a href="../pages/sobre_nos.html">Sobre Nós</a>
            <a href="../pages/cadastrarFuncionarios.html">Cadastrar usuário</a>
            <a href="../pages/cadastrarRepresas.html">Cadastrar Represas</a>
        </nav>
        <nav class="nav-direita">
            <img class="img-perfil" src="../public/img/icone-perfil.png" alt="icone do perfil">
        </nav>
    </header>
    <section id="container">
        <main>
            <!-- Indicadores Rápidos -->
            <ul class="lista-informacoes">
                <li>
                    <div class="icone">
                        <i class='bx bx-water'></i>
                    </div>
                    <span class="texto">
                        <h3>5</h3>
                        <p>Usinas Cadastradas</p>
                    </span>
                </li>
                <li>
                    <div class="icone">
                        <i class='bx bxs-bar-chart-alt-2'></i>
                    </div>
                    <span class="texto">
                        <h3>2</h3>
                        <p>Usinas com nível da água adequado</p>
                    </span>
                </li>
                <li>
                    <div class="icone">
                        <i class='bx bxs-error'></i>
                    </div>
                    <span class="texto">
                        <h3>3</h3>
                        <p>Usinas com alertas em nível da água</p>
                    </span>
                </li>
            </ul>

            <!-- Tabela de Últimos Registros -->
            <div class="secao-tabela">
                <div class="tabela-pedidos">
                    <div class="cabecalho">
                        <h3>Últimos Registros</h3>
                        <i class='bx bx-search'></i>
                        <i class='bx bx-filter'></i>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Reservatório</th>
                                <th>Última Medição</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <table id="modelTable">

                                <details>
                                    <summary class="usina-summary">
                                        <div class="div-img-nome-usina">
                                            <p>Usina 1</p>
                                            <img src="../public/img/usina1.png" alt="Reservatório logo">
                                        </div>
                                        <p class="info-ajustada"><strong>Data:</strong> 03/04/2025</p>
                                        <p class="info-ajustada"><strong>Status:</strong> <span class="status normal">Normal</span></p>
                                    </summary>
                                    
                                    

                                    <div class="container-graficos">
                                        <div class="card-grafico">
                                            <h2>Volume de Água Atual</h2>
                                            <canvas id="sensorDigital"></canvas>
                                            <p class="descricao-grafico">
                                                Histórico de Volume de Água
                                            </p>
                                        </div>
                                

                                    </div>
                                </details> 
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </section>
    <footer class="footer">
        <h3>Fale conosco: sac@hydroscan.com</h3>
    </footer>

    <script>
   var sensorDigital = new Chart(document.getElementById('sensorDigital').getContext('2d'), {
            type: 'line',
            data: {
                datasets: [{
                    label: 'Digital',
                    borderColor: '#63B1BC',
                    backgroundColor: '#0762C8'
                }]
            },
            options: {
                scales: {
                    x: {
                        beginAtZero: true
                    },
                    y: {
                        title: {
                            display: true,
                            text: '(0-1)'
                        },
                        beginAtZero: true
                    }
                }
            }
        });

        var paginacao = {};
        var tempo = {};

        function obterDados(grafico, endpoint) {
            // fetch('http://localhost:3300/sensores/' + endpoint)

            fetch('http://localhost:3300/sensores/digital')

                .then(response => response.json())
                .then(valores => {
                    if (paginacao[endpoint] == null) {
                        paginacao[endpoint] = 0;
                    }
                    if (tempo[endpoint] == null) {
                        tempo[endpoint] = 0;
                    }

                    var ultimaPaginacao = paginacao[endpoint];
                    paginacao[endpoint] = valores.length;
                    valores = valores.slice(ultimaPaginacao);

                    valores.forEach((valor) => {
                        if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
                            grafico.data.labels.shift();
                            grafico.data.datasets[0].data.shift();
                        }

                        grafico.data.labels.push(tempo[endpoint]++);
                        grafico.data.datasets[0].data.push(parseFloat(valor));
                        grafico.update();
                    });
                })
                .catch(error => console.error('Erro ao obter dados:', error));
        }

        setInterval(() => {
            obterDados(sensorDigital, 'digital');
        }, 1000);

</script>


</body>

</html>